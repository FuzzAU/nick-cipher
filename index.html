<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nickâ€™s Caesar Dial Decoder</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    .card { max-width: 980px; margin: 0 auto; padding: 20px; border: 1px solid rgba(127,127,127,.35); border-radius: 14px; }
    h1 { margin: 0 0 12px; font-size: 22px; }

    .label { font-weight: 900; margin: 14px 0 8px; }

    .cipherline { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
    .ch {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 22px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(127,127,127,.25);
      background: rgba(127,127,127,.06);
      user-select: none;
    }
    .ch.active {
      border-color: rgba(80,140,255,.9);
      box-shadow: 0 0 0 2px rgba(80,140,255,.25);
      background: rgba(80,140,255,.10);
    }
    .ch.good {
      border-color: rgba(60,200,120,.9);
      box-shadow: 0 0 0 2px rgba(60,200,120,.20);
      background: rgba(60,200,120,.10);
    }

    .panel { display: grid; grid-template-columns: 1fr 1.4fr; gap: 14px; }
    @media (max-width: 820px) { .panel { grid-template-columns: 1fr; } }

    .work {
      padding: 14px;
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
      background: rgba(127,127,127,.06);
    }

    .kv {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px 10px;
      align-items: center;
      font-size: 18px;
    }

    .pill {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.35);
      background: rgba(127,127,127,.08);
      font-weight: 900;
    }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }

    .alph {
      margin-top: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 16px;
      line-height: 1.6;
      overflow-x: auto;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.25);
      background: rgba(127,127,127,.06);
      white-space: pre;
    }

    .dialBox {
      padding: 16px;
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
    }

    .dialHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .dialHeader .big {
      font-size: 18px;
      font-weight: 900;
    }
    .dialHeader .rot {
      font-size: 18px;
      font-weight: 900;
    }

    input[type="range"] { width: 100%; }

    .btnRow { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 12px; }
    button {
      cursor: pointer;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.45);
      background: transparent;
      font-weight: 950;
      font-size: 16px;
    }
    button:disabled { opacity: .45; cursor: not-allowed; }

    .answer {
      margin-top: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 28px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(127,127,127,.35);
      background: rgba(127,127,127,.06);
      letter-spacing: 1px;
      min-height: 44px;
    }

    .msg {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.25);
      background: rgba(127,127,127,.06);
      font-size: 14px;
      min-height: 20px;
    }
    .msg.ok { border-color: rgba(60,200,120,.6); background: rgba(60,200,120,.10); }
    .msg.bad { border-color: rgba(255,90,90,.6); background: rgba(255,90,90,.10); }

    .hint { opacity: .85; font-size: 13px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Decode the Nintendo Store Code ðŸŽ®</h1>

    <div class="label">Encrypted text</div>
    <div class="cipherline" id="cipherLine"></div>

    <div class="label">Rotation key</div>
    <div class="cipherline" id="keyLine"></div>

    <div class="panel" style="margin-top:14px;">
      <!-- Left: explanation / mapping -->
      <div class="work">
        <div class="kv">
          <div><span class="pill">Step</span></div>
          <div><span id="posText" class="mono"></span></div>

          <div><span class="pill">Cipher</span></div>
          <div><span id="cipherChar" class="mono"></span></div>

          <div><span class="pill">Key digit</span></div>
          <div><span id="keyDigit" class="mono"></span></div>

          <div><span class="pill">Your pick</span></div>
          <div><span id="preview" class="mono"></span></div>
        </div>

        <div class="alph" id="alphaMap"></div>

        <div class="hint">
          Slide the dial to choose a rotation. Press <b>Add</b>. If itâ€™s correct, it locks in and moves to the next character.
          Numbers donâ€™t changeâ€”just press <b>Add</b>.
        </div>
      </div>

      <!-- Right: dial + actions -->
      <div class="dialBox">
        <div class="dialHeader">
          <div class="big">Dial</div>
          <div class="rot mono">Rotation: <span id="rotNow">0</span></div>
        </div>

        <input id="dial" type="range" min="0" max="25" step="1" value="0" />

        <div class="btnRow">
          <button id="addBtn">Add</button>
          <button id="backBtn">Back</button>
          <button id="startOverBtn">Start over</button>
        </div>

        <div class="answer" id="answerBox"></div>
        <div class="msg" id="msgBox"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  // Locked puzzle inputs
  const CIPHER = "B1AR5DY26W5U6UGJ";
  const KEY    = "3025068001070983";

  // The intended answer (used to validate entries)
  const TARGET = "E1CW5JG26X5B6DOM";

  const A = "A".charCodeAt(0);
  const Z = "Z".charCodeAt(0);

  const cipherLine = document.getElementById("cipherLine");
  const keyLine = document.getElementById("keyLine");

  const posText = document.getElementById("posText");
  const cipherChar = document.getElementById("cipherChar");
  const keyDigitEl = document.getElementById("keyDigit");
  const preview = document.getElementById("preview");
  const alphaMap = document.getElementById("alphaMap");

  const dial = document.getElementById("dial");
  const rotNow = document.getElementById("rotNow");
  const addBtn = document.getElementById("addBtn");
  const backBtn = document.getElementById("backBtn");
  const startOverBtn = document.getElementById("startOverBtn");
  const answerBox = document.getElementById("answerBox");
  const msgBox = document.getElementById("msgBox");

  const cipherSpans = [];
  const keySpans = [];

  function mkSpan(ch) {
    const s = document.createElement("span");
    s.className = "ch";
    s.textContent = ch;
    return s;
  }

  for (let i = 0; i < CIPHER.length; i++) {
    const s = mkSpan(CIPHER[i]);
    cipherLine.appendChild(s);
    cipherSpans.push(s);
  }
  for (let i = 0; i < KEY.length; i++) {
    const s = mkSpan(KEY[i]);
    keyLine.appendChild(s);
    keySpans.push(s);
  }

  let pos = 0;
  let answer = [];

  function isUpperAlpha(ch) {
    const c = ch.charCodeAt(0);
    return c >= A && c <= Z;
  }
  function isDigit(ch) {
    return ch >= "0" && ch <= "9";
  }
  function shiftForward(ch, shift) {
    const c = ch.charCodeAt(0);
    return String.fromCharCode(A + ((c - A + shift) % 26));
  }

  function renderAlphaMap(shift, cipherCh) {
    const base = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const rotated = base.slice(shift) + base.slice(0, shift);

    let markerLine = "";
    if (isUpperAlpha(cipherCh)) {
      const idx = cipherCh.charCodeAt(0) - A;
      markerLine = " ".repeat(idx) + "â–²";
    }

    alphaMap.textContent =
      `Normal:  ${base}\n` +
      `Rotate:  ${rotated}\n` +
      (markerLine ? `         ${markerLine}  (cipher letter position)\n` : "");
  }

  function setMsg(text, kind) {
    msgBox.textContent = text || "";
    msgBox.classList.remove("ok", "bad");
    if (kind) msgBox.classList.add(kind);
  }

  function updateUI() {
    // highlight current position in cipher + key
    cipherSpans.forEach((s, i) => {
      s.classList.toggle("active", i === pos);
      s.classList.toggle("good", i < answer.length);
    });

    keySpans.forEach((s, i) => s.classList.toggle("active", i === pos));

    const done = pos >= CIPHER.length;
    const c = CIPHER[pos] ?? "";
    const k = KEY[pos] ?? "";

    posText.textContent = `${Math.min(pos + 1, CIPHER.length)} / ${CIPHER.length}`;
    cipherChar.textContent = done ? "(done)" : `"${c}"`;
    keyDigitEl.textContent = done ? "" : k;

    // Dial state
    rotNow.textContent = dial.value;

    // Disable dial on digits (since they don't rotate)
    dial.disabled = done || isDigit(c);

    // Preview based on dial
    let picked = "";
    if (!done) {
      if (isDigit(c)) picked = c;
      else if (isUpperAlpha(c)) picked = shiftForward(c, Number(dial.value));
      else picked = c;
    }
    preview.textContent = picked ? `"${picked}"` : "";

    renderAlphaMap(Number(dial.value), c);

    // Buttons
    addBtn.disabled = done;
    backBtn.disabled = answer.length === 0;

    // Show answer progress
    answerBox.textContent = answer.join("");
  }

  function addCurrent() {
    if (pos >= CIPHER.length) return;

    const c = CIPHER[pos];
    const expected = TARGET[pos];

    let picked;
    if (isDigit(c)) {
      picked = c; // digits pass through
    } else if (isUpperAlpha(c)) {
      picked = shiftForward(c, Number(dial.value));
    } else {
      picked = c;
    }

    if (picked !== expected) {
      setMsg("Not quite â€” try a different rotation.", "bad");
      return;
    }

    // Correct
    setMsg("Nice! âœ…", "ok");
    answer.push(picked);
    pos++;

    // Reset dial for next char (keeps the interaction consistent)
    dial.value = "0";

    // If finished, celebrate
    if (pos >= CIPHER.length) {
      setMsg("Unlocked! ðŸŽ‰", "ok");
    }

    updateUI();
  }

  function back() {
    if (answer.length === 0) return;
    answer.pop();
    pos = Math.max(0, pos - 1);
    dial.value = "0";
    setMsg("", null);
    updateUI();
  }

  function startOver() {
    pos = 0;
    answer = [];
    dial.value = "0";
    setMsg("", null);
    updateUI();
  }

  dial.addEventListener("input", () => {
    setMsg("", null);
    updateUI();
  });

  addBtn.addEventListener("click", addCurrent);
  backBtn.addEventListener("click", back);
  startOverBtn.addEventListener("click", startOver);

  // Init
  setMsg("", null);
  updateUI();
})();
</script>
</body>
</html>
